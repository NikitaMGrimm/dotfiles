#!/usr/bin/env python3

import argparse
import os
import subprocess
import shutil

parser = argparse.ArgumentParser(description='Find common lines between the output of two scripts')
parser.add_argument('script1', help='the first script')
parser.add_argument('script2', help='the second script')
parser.add_argument('--shell', default=os.getenv('SHELL', shutil.which('zsh') or 'bash'), help='the shell command to use (default: $SHELL if set, otherwise zsh if available, otherwise bash)')

args = parser.parse_args()

try:
    # Run the first script and capture its output
    proc1 = subprocess.run([args.shell, '-c', args.script1], capture_output=True, text=True)
    output1 = proc1.stdout.strip().splitlines()

    # Run the second script and capture its output
    proc2 = subprocess.run([args.shell, '-c', args.script2], capture_output=True, text=True)
    output2 = proc2.stdout.strip().splitlines()

    # Find the common lines in the output
    common_lines = set(output1).intersection(output2)

    # Print the common lines in the order they appear in script1
    for line in output1:
        if line.strip() in common_lines:
            print(line.strip())

except subprocess.CalledProcessError as e:
    print(f"Error: {e}")

